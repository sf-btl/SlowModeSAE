// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// USERS & AUTHENTICATION
// ==========================================

model Utilisateur {
  id_user         String       @id @default(uuid())
  email           String       @unique
  mot_de_passe    String
  nom             String
  prenom          String
  adresse_postale String?
  ville           String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  // Relations
  couturier       Couturier?
  commandes       Commande[]   @relation("UtilisateurCommandes")
  posts           Post[]
  
  @@map("utilisateurs")
}

model Couturier {
  id_couturier        String   @id @default(uuid())
  bio_description     String?  @db.Text
  annees_experience   Int?
  note_moyenne        Float?   @default(0)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  // Relations
  id_user             String   @unique
  utilisateur         Utilisateur @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  
  commandes           Commande[] @relation("CouturierCommandes")
  patrons             Patron[]
  
  @@map("couturiers")
}

model Fournisseur {
  id_fournisseur  String   @id @default(uuid())
  siret           String   @unique
  nom_societe     String
  note_moyenne    Float?   @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  tissus          Tissu[]
  
  @@map("fournisseurs")
}

// ==========================================
// PRODUCTS & MATERIALS
// ==========================================

model Produit {
  id_produit    String   @id @default(uuid())
  nom_produit   String
  description   String?  @db.Text
  prix_unitaire Decimal  @db.Decimal(10, 2)
  stock         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  commandes     Commande[]
  
  @@map("produits")
}

model Tissu {
  id_tissu        String      @id @default(uuid())
  matiere         String
  grammage        String?
  couleur         String?
  metrage_dispo   Int?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  id_fournisseur  String
  fournisseur     Fournisseur @relation(fields: [id_fournisseur], references: [id_fournisseur], onDelete: Cascade)
  
  @@map("tissus")
}

model Patron {
  id_patron       String     @id @default(uuid())
  nom_patron      String
  difficulte      String?    // Ex: "Facile", "Moyen", "Difficile"
  prix_digital    Decimal?   @db.Decimal(10, 2)
  fichier_pdf     String?    // URL ou chemin vers le PDF
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  // Relations
  id_couturier    String
  couturier       Couturier  @relation(fields: [id_couturier], references: [id_couturier], onDelete: Cascade)
  
  @@map("patrons")
}

// ==========================================
// ORDERS & PURCHASES
// ==========================================

enum StatutCommande {
  EN_ATTENTE
  EN_COURS
  TERMINEE
  ANNULEE
}

model Commande {
  id_commande       String          @id @default(uuid())
  date_commande     DateTime        @default(now())
  statut            StatutCommande  @default(EN_ATTENTE)
  adresse_livraison String?
  montant_total     Decimal         @db.Decimal(10, 2)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  // Relations
  id_user           String
  utilisateur       Utilisateur     @relation("UtilisateurCommandes", fields: [id_user], references: [id_user], onDelete: Cascade)
  
  id_produit        String
  produit           Produit         @relation(fields: [id_produit], references: [id_produit], onDelete: Restrict)
  
  id_couturier      String?
  couturier         Couturier?      @relation("CouturierCommandes", fields: [id_couturier], references: [id_couturier], onDelete: SetNull)
  
  acheteur          Acheteur?
  
  @@map("commandes")
}

model Acheteur {
  id_acheteur     String   @id @default(uuid())
  mensurations    String?  @db.Text // JSON ou texte structur√©
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  id_commande     String   @unique
  commande        Commande @relation(fields: [id_commande], references: [id_commande], onDelete: Cascade)
  
  @@map("acheteurs")
}

// ==========================================
// COMMUNITY & CONTENT
// ==========================================

model Post {
  id_post         String   @id @default(uuid())
  titre           String
  date_creation   DateTime @default(now())
  date_publication DateTime?
  description     String?  @db.Text
  photo_resultat  String?  // URL de l'image
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  id_user         String
  utilisateur     Utilisateur @relation(fields: [id_user], references: [id_user], onDelete: Cascade)
  
  @@map("posts")
}
