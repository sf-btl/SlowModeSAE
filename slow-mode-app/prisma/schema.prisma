// 1. Définition de la connexion
generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ==========================================
// GESTION DES UTILISATEURS (Héritage)
// ==========================================

model Utilisateur {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  mot_de_passe   String
  nom            String
  prenom         String
  adresse_postale String?
  ville          String?
  createdAt      DateTime @default(now())

  // Relations 1:1
  acheteur    Acheteur?
  couturier   Couturier?
  fournisseur Fournisseur?
}

model Acheteur {
  // ICI : L'ID est à la fois PK et FK. Pas d'auto-incrément.
  utilisateurId Int         @id 
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id])

  mensurations  String? 

  // Relations
  commandes     Commande[] 
}

model Couturier {
  // ICI : Idem
  utilisateurId    Int         @id
  utilisateur      Utilisateur @relation(fields: [utilisateurId], references: [id])

  bio_description   String?
  annees_experience Int?
  note_moyenne      Float?  @default(0)

  // Relations
  commandesGerees   Commande[] 
  patronsCrees      Patron[]   
  postsPublies      Post[]     
  produits          Produit[]
}

model Fournisseur {
  // ICI : Idem
  utilisateurId      Int         @id
  utilisateur        Utilisateur @relation(fields: [utilisateurId], references: [id])

  siret              String  @unique
  nom_societe        String
  note_moyenne       Float?  @default(0)

  // Relations
  commandesExpediees Commande[] 
  postsSponsorises   Post[]     
  tissusVendus       Tissu[]    
}

// ==========================================
// COMMANDES & PRODUITS
// ==========================================

model Commande {
  id                Int      @id @default(autoincrement())
  date_commande     DateTime @default(now())
  statut            String   @default("EN_ATTENTE")
  adresse_livraison String
  montant_total     Float

  // Relations : Note que le champ de liaison change de nom pour être plus clair
  // Il pointe maintenant vers "utilisateurId" de la table Acheteur/Couturier
  
  acheteurId    Int
  acheteur      Acheteur @relation(fields: [acheteurId], references: [utilisateurId])

  couturierId   Int
  couturier     Couturier? @relation(fields: [couturierId], references: [utilisateurId])

  fournisseurId Int?
  fournisseur   Fournisseur? @relation(fields: [fournisseurId], references: [utilisateurId])
  
  produits      Produit[]
}

model Produit {
  id          Int     @id @default(autoincrement())
  nom_produit String
  description String?
  imagePath String?
  prix_unitaire Float
  couturierId Int
  couturier   Couturier @relation(fields: [couturierId], references: [utilisateurId])

  stock       Int

  commandes   Commande[] 
}

// ==========================================
// AUTRES (Patrons, Posts, Tissus)
// ==========================================

model Patron {
  id          Int     @id @default(autoincrement())
  nom_patron  String
  fichier_pdf String 

  couturierId Int
  couturier   Couturier @relation(fields: [couturierId], references: [utilisateurId])
}

model Post {
  id               Int      @id @default(autoincrement())
  titre_creation   String
  date_publication DateTime @default(now())
  description      String?
  photo_resultat   String?

  // Auteur du post
  couturierId   Int?
  couturier     Couturier?   @relation(fields: [couturierId], references: [utilisateurId])

  fournisseurId Int?
  fournisseur   Fournisseur? @relation(fields: [fournisseurId], references: [utilisateurId])
}

model Tissu {
  id            Int     @id @default(autoincrement())
  matiere       String
  grammage      Int?    
  couleur       String
  metrage_dispo Float
  prix_unitaire Float
  imagePath     String
  fournisseurId Int
  fournisseur   Fournisseur @relation(fields: [fournisseurId], references: [utilisateurId])
}
